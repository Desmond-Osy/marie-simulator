!function(e){"use strict";e.module("MarieSimulator").controller("MarieCtrl",["$scope","$timeout","$uibModal","assembler","cpu","memory",function(e,t,r,n,a,s){var o=this;e.cpu=a,e.memory=s,e.outputFilter="dec",e.inputFilter="dec",e.assembly={},e.delay=1e3,e.status="Ready to load program instructions.",e.assembled=!1,e.halted=!1,e.interrupted=!1,e.programLoaded=!1,e.running=!1,e.code="ORG 0\nLOAD X\nADD Y\nOUTPUT\nHALT\nX, DEC 0\nY, DEC 1",e.reset=function(){a.reset(),s.reset(),e.assembled=!1,e.halted=!1,e.interrupted=!1,e.programLoaded=!1,e.running=!1,e.halt(),e.status="Ready to load program instructions."},e.assemble=function(){return e.reset(),e.assembly=n.assemble(e.code),e.assembly.errors.length>0?(o.openAssemblyErrorModal(),void(e.assembly={})):(e.assembled=!0,void e.assembly.program.forEach(function(e){s.data[e.address]=e.hexcode}))},e.stepForward=function(){e.status="Press [Step Forward] to continue.",e.step()},e.step=function(){if(a.halt||a.interrupt)return!1;try{a.fetch(),a.execute()}catch(t){return e.halt(t),!1}return!0};var l;e.run=function(){e.running=!0,l=t(function(){e.step()&&e.run()},e.delay)},e.halt=function(e){t.cancel(l),e?a.halt||a.interrupt?(a.interrupt&&o.openInputModal(),this.status=e):this.status="Machine halted abnormally. Error: "+e:this.status="Halted at user request."},o.openAssemblyErrorModal=function(){r.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/errors.html",controller:"ErrorModalInstanceCtrl",controllerAs:"$errorModal",resolve:{errors:function(){return e.assembly.errors}}})},o.openInputModal=function(){var t=r.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/input.html",controller:"InputModalInstanceCtrl",controllerAs:"$inputModal"});t.result.then(function(t){e.cpu.settle(t),e.run()})},e.delays=[{name:"1 Hz",value:1},{name:"4 Hz",value:4},{name:"8 Hz",value:8},{name:"16 Hz",value:16}],e.setDelay=function(t){e.delay=1e3/t},e.setFilter=function(t){e.outputFilter=t},e.dissableAssembleButton=function(){return e.running},e.dissableRunButton=function(){return!e.assembled},e.dissableHaltButton=function(){return!e.assembled||!e.running},e.dissableStepButton=function(){return!e.assembled||e.running}}])}(window.angular);