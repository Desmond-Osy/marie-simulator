angular.module("MarieSimulator").service("assembler",["opcodes",function(e){return{assemble:function(n){var a=/^[\s]?(?:(\w*)[,])?[\s]*(?:(\w*))?[\s]*(?:(-?\w*))?/,l=/^\d.*$/,i=/^\d[0-9a-fA-F]*$/,s=1,r=2,o=3,t=4095,m=32767,u=-32768,p=["ORiGination directive must be first noncomment line of program.","A label cannot have 0..9 as its beginning character.","Statement label must be unique.","Instruction not recognized.","Missing instruction.","Missing operand.","Hex address literal out of range 0 to 0FFF allowable.","Invalid decimal value: -32768 to 32767 allowable.","Invalid octal value: 0 to 177777 allowable.","Invalid hexadecimal value: 0 to FFFF allowable.","Operand undefined.","Maximum source lines exceeded. Assembly halted.","Maximum line number exceeded. Assembly halted."],d=n.split("\n"),h=[],c=0,b={},v=[];d.length>t&&v.push({name:p,line:0});for(var g=0,f=d.length;g<f;++g){var x=d[g];if(!/^\s*(?:\/.*)?$/.test(x)){var w=a.exec(x),F=w[s],I=w[r].toUpperCase(),M=w[o];if("ORG"!=I){if(F&&(F.match(l)&&v.push({name:p[1],line:g}),F in b&&v.push({name:p[2],line:g}),b[F]=h.length+c),"END"==I)break;h.push({address:h.length,label:F,opcode:I,operand:M,line:g+1})}else h.length>0&&v.push({name:p[0],line:g}),M||v.push({name:p[5],line:g}),c=parseInt(M,16)}}h.length>t&&v.push({name:p[12],line:t});for(var g=0,f=h.length;g<f;g++){var A=h[g],O=void 0;switch(A.opcode){case"DEC":O=10;break;case"OCT":O=8;break;case"HEX":O=16}if(O){A.operand||v.push({name:p[5],line:A.line});var k=parseInt(A.operand,O);isNaN(k)&&(10==O?v.push({name:p[7],line:A.line}):8==O?v.push({name:p[8],line:A.line}):16==O&&v.push({name:p[9],line:A.line})),(u>k||k>m)&&(10==O?v.push({name:p[7],line:A.line}):8==O?v.push({name:p[8],line:A.line}):16==O&&v.push({name:p[9],line:A.line})),A.hexcode=k}else{var I=e[A.opcode],M=A.operand;I?(I.operand&&!M&&v.push({name:p[5],line:A.line}),M&&(M.match(i)?(M=parseInt(M,16),M>4095&&v.push({name:p[6],line:A.line})):(M in b||v.push({name:p[10],line:A.line}),M=b[M])),A.hexcode=I.opcode<<12|M):v.push({name:p[3],line:A.line})}}return{origin:c,program:h,symbols:b,errors:v}}}}]);