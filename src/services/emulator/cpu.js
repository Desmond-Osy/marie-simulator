!function(t){"use strict";t.module("MarieSimulator").service("cpu",["opcodes","memory",function(t,s){var i={};return i.reset=function(){this.ac=0,this.ir=0,this.mbr=0,this.pc=0,this.mar=0,this.inreg=0,this.outreg=0,this.outputs=[],this.interrupt=!1,this.halt=!1},i.settle=function(t){this.inreg=t>>>0&255,this.ac=this.inreg>>>0&65535,this.interrupt=!1},i.fetch=function(){this.mar=this.pc>>>0&4095,this.ir=s.read(this.pc)>>>0&65535,this.pc=this.pc+1>>>0&4095},i.execute=function(){var i=this.ir>>12&15,h=4095&this.ir;switch(i){case t.JNS.opcode:this.mbr=this.pc>>>0&65535,this.mar=h>>>0&4095,s.write(this.mar,this.mbr),this.mbr=h>>>0&65535,this.ac=1,this.ac=this.ac+this.mbr>>>0&65535,this.pc=this.ac>>>0&4095;break;case t.LOAD.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.ac=this.mbr>>>0&65535;break;case t.STORE.opcode:this.mar=h>>>0&4095,this.mbr=this.ac>>>0&65535,s.write(this.mar,this.mbr);break;case t.ADD.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.ac=this.ac+this.mbr>>>0&65535;break;case t.SUBT.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.ac=this.ac-this.mbr>>>0&65535;break;case t.INPUT.opcode:throw this.interrupt=!0,"Machine waiting for interrupt to be settled.";case t.OUTPUT.opcode:this.outreg=this.ac>>>0&255,this.outputs.push(this.outreg);break;case t.HALT.opcode:throw this.halt=!0,"Machine halted normally.";case t.SKIPCOND.opcode:var r=3072&this.ir,a=this.ac>32767?this.ac-65536:this.ac;0==r&&a<0?(console.log("skip 0x000"),this.pc=this.pc+1>>>0&4095):1024==r&&0==a?(console.log("skip 0x400"),this.pc=this.pc+1>>>0&4095):2048==r&&a>0&&(console.log("skip 0x800"),this.pc=this.pc+1>>>0&4095);break;case t.JUMP.opcode:this.pc=this.ir>>>0&4095;break;case t.CLEAR.opcode:this.ac=0;break;case t.ADDI.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.mar=this.mbr>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.ac=this.ac+this.mbr>>>0&65535;break;case t.JUMPI.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.pc=this.mbr>>>0&4095;break;case t.LOADI.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.mar=this.mbr>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.ac=this.mbr>>>0&65535;break;case t.STOREI.opcode:this.mar=h>>>0&4095,this.mbr=s.read(this.mar)>>>0&65535,this.mar=this.mbr>>>0&4095,this.mbr=this.ac>>>0&65535,s.write(this.mar,this.mbr);break;case t.DEC.opcode:case t.OCT.opcode:case t.HEX.opcode:case t.ORG.opcode:case t.END.opcode:}},i.reset(),i}])}(window.angular);